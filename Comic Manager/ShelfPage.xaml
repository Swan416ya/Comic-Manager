<Page
    x:Class="Comic_Manager.ShelfPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Comic_Manager"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Transparent">
    <!-- 背景透明以显示 Mica -->

    <Grid>
        <!-- 1. 漫画网格列表 -->
        <GridView x:Name="ComicGridView" 
                  Padding="20" 
                  SelectionMode="Single">

            <!-- 【新增代码】在这里重写选中状态的颜色资源 -->
            <GridView.Resources>
                <!-- 1. 把选中时的“边框”颜色设为透明 -->
                <SolidColorBrush x:Key="GridViewItemBorderBrushSelected" Color="Transparent" />
                <SolidColorBrush x:Key="GridViewItemBorderBrushSelectedPointerOver" Color="Transparent" />

                <!-- 2. 把选中时的“内部背景”也改一下 (可选) -->
                <!-- 默认是一个很浅的蓝色，如果你想彻底看不出选中效果，把它也设为 Transparent -->
                <!-- 这里我把它设为一种很淡的灰色，让你知道选中了，但不会太突兀 -->
                <SolidColorBrush x:Key="GridViewItemBackgroundSelected" Color="#20808080" />
                <SolidColorBrush x:Key="GridViewItemBackgroundSelectedPointerOver" Color="#30808080" />

                <!-- 3. 去掉“复选框” (多选模式下右上角那个勾，虽然后台是Single但有时候会有残留视觉) -->
                <Thickness x:Key="GridViewItemCheckThemeThickness">0</Thickness>
            </GridView.Resources>

            <!-- 定义每一项长什么样 -->
            <GridView.ItemTemplate>
                <DataTemplate x:DataType="local:ComicSeries">
                    <!-- 这是一个卡片 -->
                    <Grid Width="140" Height="240" Background="Transparent">
                        <!-- 定义右键菜单 (Flyout) -->
                        <!-- Opening 事件很重要，我们需要在菜单弹出前动态生成选项 -->
                        <Grid.ContextFlyout>
                            <MenuFlyout Opening="OnContextMenuOpening">
                                <MenuFlyoutItem Text="修改信息" Icon="Edit" Click="OnModifyClick" Tag="{x:Bind}"/>
                                <MenuFlyoutSeparator/>
                                <MenuFlyoutSubItem Text="添加到分类" x:Name="AddToMenu"/>
                                <MenuFlyoutSubItem Text="移出分类" x:Name="RemoveFromMenu"/>
                            </MenuFlyout>
                        </Grid.ContextFlyout>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <!-- 图片占大部分 -->
                            <RowDefinition Height="Auto"/>
                            <!-- 文字在下面 -->
                        </Grid.RowDefinitions>

                        <!-- 封面图 (圆角) -->
                        <Border Grid.Row="0" CornerRadius="8" Margin="0,0,0,8">
                            <Border.Background>
                                <SolidColorBrush Color="#20808080"/>
                                <!-- 占位背景色 -->
                            </Border.Background>
                            <Image Source="{x:Bind CoverImageBitmap, Mode=OneWay}" 
                                   Stretch="UniformToFill"/>
                        </Border>

                        <!-- 文字信息 -->
                        <StackPanel Grid.Row="1">
                            <TextBlock Text="{x:Bind Title, Mode=OneWay}" 
                                       FontWeight="Bold" 
                                       TextTrimming="CharacterEllipsis"
                                       ToolTipService.ToolTip="{x:Bind Title, Mode=OneWay}"/>

                            <TextBlock Text="{x:Bind Author, Mode=OneWay}" 
                                       FontSize="12" 
                                       Opacity="0.6" 
                                       TextTrimming="CharacterEllipsis"/>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </GridView.ItemTemplate>
        </GridView>

        <!-- 2. 右下角浮动添加按钮 -->
        <Button x:Name="AddComicButton"
                Click="OnAddComicClick"
                Width="56" Height="56"
                CornerRadius="28"
                HorizontalAlignment="Right" 
                VerticalAlignment="Bottom"
                Margin="0,0,32,32"
                Background="{ThemeResource SystemControlBackgroundAccentBrush}"
                BorderThickness="0"
                Shadow="{ThemeResource SharedShadow}"
                Translation="0,0,32">
            <FontIcon Glyph="&#xE710;" FontFamily="Segoe Fluent Icons" FontSize="24" Foreground="White"/>
        </Button>
    </Grid>
</Page>